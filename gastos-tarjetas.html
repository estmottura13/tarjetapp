<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>TarjetApp</title>
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Barlow:wght@300;400;500;600;700&family=Barlow+Condensed:wght@600;700;800&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<style>
:root{--black:#0a0a0a;--bg:#141414;--surface:#1a1a1a;--surface2:#222;--border:#333;--red:#e50914;--red-glow:rgba(229,9,20,.25);--text:#fff;--text2:#e5e5e5;--muted:#808080;--muted2:#555;--radius:4px;--radius-lg:6px;--t:.2s ease}
*{box-sizing:border-box;margin:0;padding:0}
body{background:var(--bg);color:var(--text);font-family:'Barlow',sans-serif;font-size:14px;min-height:100vh;overflow-x:hidden}
.topbar{position:fixed;top:0;left:0;right:0;z-index:50;height:68px;display:flex;align-items:center;justify-content:space-between;padding:0 48px;background:linear-gradient(to bottom,rgba(10,10,10,.95),rgba(10,10,10,0));transition:background var(--t)}
.topbar.scrolled{background:rgba(10,10,10,.98)}
.logo-mark{font-family:'Bebas Neue',sans-serif;font-size:32px;letter-spacing:3px;color:var(--red);text-shadow:0 0 30px var(--red-glow);user-select:none}
.topbar-nav{display:flex;gap:4px}
.topbar-nav-item{padding:8px 16px;cursor:pointer;font-size:13px;font-weight:500;color:var(--muted);border-radius:var(--radius);transition:all var(--t);position:relative}
.topbar-nav-item:hover{color:var(--text2)}
.topbar-nav-item.active{color:var(--text)}
.topbar-nav-item.active::after{content:'';position:absolute;bottom:0;left:16px;right:16px;height:2px;background:var(--red);border-radius:2px}
.sync-pill{display:flex;align-items:center;gap:8px;background:var(--surface);border:1px solid var(--border);border-radius:20px;padding:6px 14px;font-size:12px;color:var(--muted)}
.sync-dot{width:7px;height:7px;border-radius:50%;background:var(--muted)}
.main{padding-top:68px;min-height:100vh}
.page{display:none}
.page.active{display:block;animation:fadeIn .3s ease}
@keyframes fadeIn{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:none}}
.hero{position:relative;background:linear-gradient(135deg,#0a0a0a 0%,#1a0000 50%,#0a0a0a 100%);padding:56px 48px 40px;overflow:hidden}
.hero::before{content:'';position:absolute;inset:0;background:radial-gradient(ellipse 60% 100% at 80% 50%,rgba(229,9,20,.12),transparent 70%);pointer-events:none}
.hero-eyebrow{font-size:11px;font-weight:600;letter-spacing:3px;text-transform:uppercase;color:var(--red);margin-bottom:10px}
.hero-title{font-family:'Barlow Condensed',sans-serif;font-size:52px;font-weight:800;letter-spacing:-1px;line-height:1;margin-bottom:6px}
.hero-sub{color:var(--muted);font-size:14px}
.hero-period-nav{display:flex;align-items:center;gap:16px;margin-top:28px}
.period-arrow{width:40px;height:40px;border-radius:50%;background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.12);display:flex;align-items:center;justify-content:center;cursor:pointer;font-size:18px;color:var(--text2);transition:all var(--t)}
.period-arrow:hover{background:var(--red);border-color:var(--red)}
.period-name{font-family:'Barlow Condensed',sans-serif;font-size:22px;font-weight:700;min-width:200px}
.section-header{display:flex;justify-content:space-between;align-items:center;padding:36px 48px 16px}
.section-title{font-family:'Barlow Condensed',sans-serif;font-size:20px;font-weight:700;letter-spacing:1px;text-transform:uppercase;color:var(--text2)}
.stats-row{display:flex;gap:16px;padding:0 48px 32px;overflow-x:auto;scrollbar-width:none}
.stats-row::-webkit-scrollbar{display:none}
.stat-card{flex-shrink:0;min-width:200px;background:var(--surface);border:1px solid var(--border);border-radius:var(--radius-lg);padding:20px 24px;position:relative;overflow:hidden;transition:transform var(--t),border-color var(--t)}
.stat-card:hover{transform:scale(1.02);border-color:var(--muted2)}
.stat-card.highlight{border-color:var(--red)}
.stat-card.highlight::before{content:'';position:absolute;top:0;left:0;right:0;height:2px;background:var(--red)}
.stat-label{font-size:11px;font-weight:600;letter-spacing:2px;text-transform:uppercase;color:var(--muted);margin-bottom:10px}
.stat-amount{font-family:'Barlow Condensed',sans-serif;font-size:32px;font-weight:700;letter-spacing:-1px;line-height:1}
.stat-amount.red{color:var(--red)}
.stat-sub{font-size:11px;color:var(--muted);margin-top:6px}
.stat-bar{height:3px;background:var(--border);border-radius:2px;margin-top:10px;overflow:hidden}
.stat-bar-fill{height:100%;border-radius:2px;transition:width .6s cubic-bezier(.4,0,.2,1)}
.stat-pct{font-size:11px;color:var(--muted);margin-top:4px}
.tarjeta-cards-section{padding:0 48px 40px}
.tarjeta-detail{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius-lg);overflow:hidden;margin-bottom:12px;transition:border-color var(--t)}
.tarjeta-detail:hover{border-color:var(--muted2)}
.tarjeta-detail-header{display:flex;justify-content:space-between;align-items:center;padding:20px 24px;border-bottom:1px solid var(--border)}
.td-left{display:flex;align-items:center;gap:14px}
.td-stripe{width:4px;height:40px;border-radius:2px;flex-shrink:0}
.td-bank{font-family:'Barlow Condensed',sans-serif;font-size:18px;font-weight:700}
.td-info{font-size:12px;color:var(--muted);margin-top:2px}
.td-amount{font-family:'Barlow Condensed',sans-serif;font-size:28px;font-weight:700}
.data-table{width:100%;border-collapse:collapse}
.data-table th{text-align:left;font-size:10px;font-weight:600;letter-spacing:2px;text-transform:uppercase;color:var(--muted2);padding:12px 24px;border-bottom:1px solid var(--border);background:rgba(0,0,0,.3)}
.data-table td{padding:14px 24px;border-bottom:1px solid rgba(255,255,255,.04);font-size:13px;vertical-align:middle}
.data-table tr:last-child td{border-bottom:none}
.data-table tbody tr{transition:background var(--t)}
.data-table tbody tr:hover td{background:rgba(255,255,255,.03)}
.data-table .total-row td{background:rgba(229,9,20,.06);color:var(--red);font-weight:700;border-top:1px solid rgba(229,9,20,.2)}
.cuota-tag{display:inline-block;padding:2px 8px;border-radius:3px;background:rgba(255,255,255,.07);color:var(--muted);font-size:10px;letter-spacing:.5px;font-weight:600}
.cuota-tag.single{background:rgba(229,9,20,.12);color:var(--red)}
.cc-visual-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:20px;padding:0 48px;margin-bottom:36px}
.cc-visual{border-radius:12px;padding:28px;min-height:180px;display:flex;flex-direction:column;justify-content:space-between;position:relative;overflow:hidden;cursor:pointer;transition:transform .25s cubic-bezier(.4,0,.2,1),box-shadow .25s ease}
.cc-visual:hover{transform:scale(1.04) translateY(-4px);box-shadow:0 24px 60px rgba(0,0,0,.6)}
.cc-visual::after{content:'';position:absolute;inset:0;background:linear-gradient(135deg,rgba(255,255,255,.12) 0%,transparent 60%);border-radius:inherit;pointer-events:none}
.cc-circles{position:absolute;right:-40px;top:-40px;width:180px;height:180px;border-radius:50%;background:rgba(255,255,255,.06);box-shadow:0 0 0 40px rgba(255,255,255,.03)}
.cc-bank-name{font-family:'Barlow Condensed',sans-serif;font-weight:800;font-size:18px;color:rgba(0,0,0,.65);letter-spacing:.5px}
.cc-card-name{font-size:12px;color:rgba(0,0,0,.45);margin-top:3px}
.cc-chip-icon{font-size:28px;line-height:1}
.cc-bottom{display:flex;justify-content:space-between;align-items:flex-end}
.cc-number{font-size:13px;color:rgba(0,0,0,.55);letter-spacing:3px;font-weight:600}
.cc-meta{font-size:11px;color:rgba(0,0,0,.45);text-align:right}
.cc-footer-btns{display:flex;gap:8px;margin-top:10px}
.cc-btn{padding:5px 12px;border-radius:4px;border:none;cursor:pointer;font-size:11px;font-weight:600;font-family:'Barlow',sans-serif;background:rgba(0,0,0,.2);color:rgba(0,0,0,.65);transition:background var(--t)}
.cc-btn:hover{background:rgba(0,0,0,.35)}
.cierres-panel{display:none;background:var(--surface);border:1px solid var(--border);border-radius:var(--radius-lg);padding:28px;margin:0 48px 32px}
.cierres-panel.open{display:block;animation:fadeIn .25s ease}
.cierres-panel-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:20px}
.cierres-panel-title{font-family:'Barlow Condensed',sans-serif;font-size:20px;font-weight:700}
.cierres-month-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(150px,1fr));gap:10px}
.cierre-month-cell{background:var(--surface2);border:1px solid var(--border);border-radius:var(--radius-lg);padding:14px;transition:border-color var(--t)}
.cierre-month-cell:focus-within{border-color:var(--red)}
.cierre-month-label{font-size:10px;font-weight:600;letter-spacing:2px;text-transform:uppercase;color:var(--muted);margin-bottom:8px}
.cierre-day-input{display:flex;align-items:center;gap:8px}
.cierre-day-val{font-size:11px;color:var(--muted)}
.page-toolbar{display:flex;justify-content:space-between;align-items:center;padding:20px 48px 0;margin-bottom:24px}
.pg-title{font-family:'Barlow Condensed',sans-serif;font-size:36px;font-weight:800;letter-spacing:-.5px}
.pg-sub{color:var(--muted);font-size:13px;margin-top:3px}
.filter-tabs{display:flex;margin:0 48px 24px;background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);padding:4px;width:fit-content}
.filter-tab{padding:8px 20px;border-radius:3px;cursor:pointer;font-size:12px;font-weight:600;letter-spacing:.5px;color:var(--muted);transition:all var(--t);text-transform:uppercase}
.filter-tab.active{background:var(--red);color:var(--text)}
.filter-tab:hover:not(.active){color:var(--text2)}
.gastos-table-wrap{margin:0 48px;background:var(--surface);border:1px solid var(--border);border-radius:var(--radius-lg);overflow:hidden}
.btn{display:inline-flex;align-items:center;gap:8px;padding:10px 22px;border-radius:var(--radius);border:none;cursor:pointer;font-family:'Barlow',sans-serif;font-size:13px;font-weight:700;letter-spacing:.5px;transition:all var(--t);text-transform:uppercase}
.btn-red{background:var(--red);color:#fff}
.btn-red:hover{background:#f4101e;box-shadow:0 4px 20px var(--red-glow);transform:translateY(-1px)}
.btn-ghost{background:rgba(255,255,255,.08);color:var(--text2);border:1px solid var(--border)}
.btn-ghost:hover{background:rgba(255,255,255,.14)}
.btn-danger-sm{background:rgba(229,9,20,.1);color:var(--red);border:1px solid rgba(229,9,20,.2);padding:5px 12px;font-size:11px}
.btn-danger-sm:hover{background:rgba(229,9,20,.2)}
.btn-sm{padding:6px 14px;font-size:11px}
.btn:disabled{opacity:.4;cursor:not-allowed;transform:none!important;box-shadow:none!important}
.modal-overlay{display:none;position:fixed;inset:0;background:rgba(0,0,0,.85);z-index:200;align-items:center;justify-content:center;backdrop-filter:blur(6px)}
.modal-overlay.open{display:flex}
.modal{background:var(--surface);border:1px solid var(--border);border-radius:8px;padding:36px;width:540px;max-width:95vw;max-height:92vh;overflow-y:auto;animation:modalIn .25s cubic-bezier(.4,0,.2,1);box-shadow:0 32px 80px rgba(0,0,0,.8)}
@keyframes modalIn{from{transform:scale(.94) translateY(16px);opacity:0}}
.modal-header{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:28px}
.modal-title{font-family:'Barlow Condensed',sans-serif;font-size:26px;font-weight:800;letter-spacing:.5px}
.modal-eyebrow{font-size:10px;font-weight:600;letter-spacing:2px;text-transform:uppercase;color:var(--red);margin-bottom:4px}
.modal-close{background:rgba(255,255,255,.08);border:none;color:var(--muted);cursor:pointer;width:32px;height:32px;border-radius:50%;font-size:18px;display:flex;align-items:center;justify-content:center;transition:all var(--t);flex-shrink:0}
.modal-close:hover{background:rgba(255,255,255,.15);color:var(--text)}
.modal-footer{display:flex;justify-content:flex-end;gap:10px;margin-top:28px;padding-top:20px;border-top:1px solid var(--border)}
.form-grid{display:grid;gap:18px}
.form-row{display:grid;grid-template-columns:1fr 1fr;gap:16px}
.field-label{display:block;font-size:10px;font-weight:700;letter-spacing:2px;text-transform:uppercase;color:var(--muted);margin-bottom:8px}
input,select{width:100%;background:var(--surface2);border:1px solid var(--border);border-radius:var(--radius);padding:12px 16px;color:var(--text);font-family:'Barlow',sans-serif;font-size:14px;outline:none;transition:border-color var(--t),box-shadow var(--t)}
input:focus,select:focus{border-color:var(--red);box-shadow:0 0 0 3px var(--red-glow)}
select option{background:var(--surface2)}
.color-picker{display:flex;gap:10px;flex-wrap:wrap}
.color-dot{width:32px;height:32px;border-radius:50%;cursor:pointer;border:3px solid transparent;transition:transform var(--t),border-color var(--t)}
.color-dot:hover{transform:scale(1.15)}
.color-dot.selected{border-color:white;box-shadow:0 0 0 2px rgba(255,255,255,.4)}
.cuota-preview-box{background:var(--surface2);border:1px solid var(--border);border-left:3px solid var(--red);border-radius:var(--radius);padding:16px}
.cuota-preview-title{font-size:10px;font-weight:700;letter-spacing:2px;text-transform:uppercase;color:var(--red);margin-bottom:10px}
.cuota-row{display:flex;justify-content:space-between;padding:5px 0;border-bottom:1px solid rgba(255,255,255,.05);font-size:12px}
.cuota-row:last-child{border-bottom:none}
.empty-state{text-align:center;padding:80px 24px;color:var(--muted)}
.empty-icon{font-size:48px;margin-bottom:16px;opacity:.5}
.empty-title{font-family:'Barlow Condensed',sans-serif;font-size:22px;font-weight:700;color:var(--muted);margin-bottom:6px}
.cc-badge{display:inline-block;padding:3px 10px;border-radius:3px;font-size:11px;font-weight:700;color:#111}
.loader{display:inline-block;width:16px;height:16px;border:2px solid rgba(255,255,255,.15);border-top-color:var(--red);border-radius:50%;animation:spin .7s linear infinite}
@keyframes spin{to{transform:rotate(360deg)}}
.loading-screen{position:fixed;inset:0;background:var(--black);z-index:999;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:20px}
.loading-logo{font-family:'Bebas Neue',sans-serif;font-size:56px;letter-spacing:6px;color:var(--red);text-shadow:0 0 40px var(--red-glow)}
.loading-bar-wrap{width:200px;height:3px;background:var(--border);border-radius:2px;overflow:hidden}
.loading-bar{height:100%;background:var(--red);border-radius:2px;animation:loadBar 1.5s ease-in-out}
@keyframes loadBar{from{width:0}to{width:100%}}
.toast{position:fixed;bottom:32px;right:32px;background:var(--surface2);border:1px solid var(--border);border-radius:var(--radius-lg);padding:14px 20px;font-size:13px;font-weight:500;z-index:999;display:none;min-width:220px;box-shadow:0 8px 32px rgba(0,0,0,.5)}
.toast.show{display:flex;align-items:center;gap:10px;animation:slideUp .2s ease}
.toast.success{border-color:rgba(229,9,20,.4)}
.toast.error{border-color:rgba(255,100,100,.4);color:#ff6464}
@keyframes slideUp{from{transform:translateY(12px);opacity:0}}
@media(max-width:768px){
.topbar{padding:0 16px}
.hero,.section-header,.tarjeta-cards-section,.cierres-panel,.page-toolbar,.gastos-table-wrap{padding-left:16px;padding-right:16px;margin-left:0;margin-right:0}
.stats-row,.filter-tabs{padding-left:16px;padding-right:16px;margin-left:0;margin-right:0}
.cc-visual-grid{grid-template-columns:1fr;padding:0 16px}
.form-row{grid-template-columns:1fr}
.hero-title{font-size:36px}
}
</style>
</head>
<body>
<div class="loading-screen" id="loading-screen">
  <div class="loading-logo">TARJETAPP</div>
  <div class="loading-bar-wrap"><div class="loading-bar"></div></div>
  <div style="color:var(--muted);font-size:12px;letter-spacing:1px;">CONECTANDO CON BASE DE DATOS</div>
</div>
<header class="topbar" id="topbar">
  <div class="logo-mark">TARJETAPP</div>
  <nav class="topbar-nav">
    <div class="topbar-nav-item active" onclick="showPage('resumen',this)">üìä Resumen</div>
    <div class="topbar-nav-item" onclick="showPage('gastos',this)">üí≥ Gastos</div>
    <div class="topbar-nav-item" onclick="showPage('tarjetas',this)">üóÇÔ∏è Tarjetas</div>
  </nav>
  <div class="sync-pill"><span class="sync-dot" id="sync-dot"></span><span id="sync-text">Conectando</span></div>
</header>
<div class="main">
  <!-- RESUMEN -->
  <div class="page active" id="page-resumen">
    <div class="hero">
      <div class="hero-eyebrow">PER√çODO DE FACTURACI√ìN</div>
      <div class="hero-title" id="hero-period-title">‚Äî</div>
      <div class="hero-sub" id="hero-period-sub">Seleccion√° un per√≠odo para ver el detalle</div>
      <div class="hero-period-nav">
        <div class="period-arrow" onclick="changePeriod(-1)">‚Äπ</div>
        <div class="period-name" id="period-label">‚Äî</div>
        <div class="period-arrow" onclick="changePeriod(1)">‚Ä∫</div>
      </div>
    </div>
    <div class="section-header"><div class="section-title">Resumen de tarjetas</div></div>
    <div class="stats-row" id="stats-row"></div>
    <div id="tarjeta-details"></div>
  </div>
  <!-- GASTOS -->
  <div class="page" id="page-gastos">
    <div class="page-toolbar">
      <div><div class="pg-title">Gastos</div><div class="pg-sub">Registr√° cada compra, en una o m√°s cuotas</div></div>
      <button class="btn btn-red" onclick="openModalGasto()">Ôºã Nuevo gasto</button>
    </div>
    <div class="filter-tabs">
      <div class="filter-tab active" onclick="filterGastos('todos',this)">Todos</div>
      <div class="filter-tab" onclick="filterGastos('pendientes',this)">Pendientes</div>
      <div class="filter-tab" onclick="filterGastos('pasados',this)">Pasados</div>
    </div>
    <div class="gastos-table-wrap">
      <table class="data-table">
        <thead><tr><th>Descripci√≥n</th><th>Tarjeta</th><th>Fecha</th><th>Monto total</th><th>Cuotas</th><th></th></tr></thead>
        <tbody id="gastos-tbody"></tbody>
      </table>
      <div id="gastos-empty" class="empty-state" style="display:none;">
        <div class="empty-icon">üõçÔ∏è</div><div class="empty-title">Sin gastos registrados</div>
        <div style="font-size:13px;">Hac√© clic en "Nuevo gasto" para empezar</div>
      </div>
    </div>
  </div>
  <!-- TARJETAS -->
  <div class="page" id="page-tarjetas">
    <div class="page-toolbar">
      <div><div class="pg-title">Mis Tarjetas</div><div class="pg-sub">Configur√° cada tarjeta y sus fechas de cierre</div></div>
      <button class="btn btn-red" onclick="openModalTarjeta()">Ôºã Nueva tarjeta</button>
    </div>
    <div class="cc-visual-grid" id="cards-grid"></div>
    <div id="tarjetas-empty" class="empty-state" style="display:none;padding:48px;">
      <div class="empty-icon">üí≥</div><div class="empty-title">No hay tarjetas</div>
    </div>
    <div class="cierres-panel" id="cierres-panel">
      <div class="cierres-panel-header">
        <div>
          <div style="font-size:10px;font-weight:700;letter-spacing:2px;text-transform:uppercase;color:var(--red);margin-bottom:4px;">FECHAS DE CIERRE</div>
          <div class="cierres-panel-title" id="cierres-panel-title">‚Äî</div>
        </div>
        <button class="btn btn-ghost btn-sm" onclick="closeCierres()">‚úï Cerrar</button>
      </div>
      <div class="cierres-month-grid" id="cierres-month-grid"></div>
    </div>
  </div>
</div>
<!-- MODAL TARJETA -->
<div class="modal-overlay" id="modal-tarjeta">
  <div class="modal">
    <div class="modal-header">
      <div><div class="modal-eyebrow">CONFIGURACI√ìN</div><div class="modal-title" id="modal-tarjeta-title">Nueva Tarjeta</div></div>
      <button class="modal-close" onclick="closeModal('modal-tarjeta')">√ó</button>
    </div>
    <div class="form-grid">
      <div><label class="field-label">Banco / Emisor</label><input type="text" id="tc-banco" placeholder="Ej: Galicia, BBVA..."></div>
      <div><label class="field-label">Nombre de la tarjeta</label><input type="text" id="tc-nombre" placeholder="Ej: Visa Gold..."></div>
      <div><label class="field-label">√öltimos 4 d√≠gitos (opcional)</label><input type="text" id="tc-digitos" maxlength="4" placeholder="1234"></div>
      <div>
        <label class="field-label">Color</label>
        <div class="color-picker">
          <div class="color-dot selected" style="background:#e50914" data-color="#e50914" onclick="selectColor(this)"></div>
          <div class="color-dot" style="background:#f5c518" data-color="#f5c518" onclick="selectColor(this)"></div>
          <div class="color-dot" style="background:#5b8fff" data-color="#5b8fff" onclick="selectColor(this)"></div>
          <div class="color-dot" style="background:#4dd9ac" data-color="#4dd9ac" onclick="selectColor(this)"></div>
          <div class="color-dot" style="background:#ff9f40" data-color="#ff9f40" onclick="selectColor(this)"></div>
          <div class="color-dot" style="background:#cc66ff" data-color="#cc66ff" onclick="selectColor(this)"></div>
          <div class="color-dot" style="background:#e8e8e8" data-color="#e8e8e8" onclick="selectColor(this)"></div>
          <div class="color-dot" style="background:#ff5e9e" data-color="#ff5e9e" onclick="selectColor(this)"></div>
        </div>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-ghost" onclick="closeModal('modal-tarjeta')">Cancelar</button>
      <button class="btn btn-red" id="btn-save-tarjeta" onclick="saveTarjeta()">Guardar</button>
    </div>
  </div>
</div>
<!-- MODAL GASTO -->
<div class="modal-overlay" id="modal-gasto">
  <div class="modal">
    <div class="modal-header">
      <div><div class="modal-eyebrow">NUEVO GASTO</div><div class="modal-title">Registrar compra</div></div>
      <button class="modal-close" onclick="closeModal('modal-gasto')">√ó</button>
    </div>
    <div class="form-grid">
      <div><label class="field-label">Descripci√≥n</label><input type="text" id="g-desc" placeholder="Ej: Supermercado, Netflix..."></div>
      <div class="form-row">
        <div><label class="field-label">Tarjeta</label><select id="g-tarjeta" onchange="previewCuotas()"></select></div>
        <div><label class="field-label">Fecha de compra</label><input type="date" id="g-fecha" onchange="previewCuotas()"></div>
      </div>
      <div class="form-row">
        <div><label class="field-label">Monto total ($)</label><input type="number" id="g-monto" placeholder="0.00" min="0" step="0.01" oninput="previewCuotas()"></div>
        <div><label class="field-label">Cantidad de cuotas</label><input type="number" id="g-cuotas" value="1" min="1" max="60" oninput="previewCuotas()"></div>
      </div>
      <div id="cuotas-preview" style="display:none;">
        <div class="cuota-preview-box">
          <div class="cuota-preview-title">DISTRIBUCI√ìN DE CUOTAS</div>
          <div id="cuotas-preview-content"></div>
        </div>
      </div>
      <div>
        <label class="field-label">Categor√≠a (opcional)</label>
        <select id="g-categoria">
          <option value="">Sin categor√≠a</option>
          <option>üõí Supermercado</option><option>üçΩÔ∏è Restaurantes</option><option>‚õΩ Combustible</option>
          <option>üè• Salud</option><option>‚úàÔ∏è Viajes</option><option>üé¨ Entretenimiento</option>
          <option>üëó Ropa</option><option>üè† Hogar</option><option>üì± Tecnolog√≠a</option>
          <option>üíº Trabajo</option><option>üéì Educaci√≥n</option><option>Otro</option>
        </select>
      </div>
      <div><label class="field-label">Nota (opcional)</label><input type="text" id="g-nota" placeholder="Detalle adicional..."></div>
    </div>
    <div class="modal-footer">
      <button class="btn btn-ghost" onclick="closeModal('modal-gasto')">Cancelar</button>
      <button class="btn btn-red" id="btn-save-gasto" onclick="saveGasto()">Registrar</button>
    </div>
  </div>
</div>
<div class="toast" id="toast"></div>
<script>
const SUPABASE_URL='https://ndiunufkwvgyrbtqctwp.supabase.co';
const SUPABASE_KEY='eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im5kaXVudWZrd3ZneXJidHFjdHdwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzE2MDE3NDksImV4cCI6MjA4NzE3Nzc0OX0.jwry-uF9hstCHLrQyq4OfeGfarsxBaxich6enVOLR2U';
const sb=supabase.createClient(SUPABASE_URL,SUPABASE_KEY);
let tarjetas=[],cierres=[],gastos=[];
let selectedColor='#e50914',editingTarjetaId=null,gastoFilter='todos';
let allPeriods=[],currentPeriodIdx=0;
window.addEventListener('scroll',()=>document.getElementById('topbar').classList.toggle('scrolled',scrollY>10));
async function init(){
  try{
    const[t,c,g]=await Promise.all([sb.from('tarjetas').select('*').order('created_at'),sb.from('cierres').select('*'),sb.from('gastos').select('*').order('created_at',{ascending:false})]);
    if(t.error||c.error||g.error)throw new Error();
    tarjetas=t.data;cierres=c.data;gastos=g.data;setSyncStatus(true);
  }catch{setSyncStatus(false);showToast('Error al conectar','error');}
  setTimeout(()=>{const l=document.getElementById('loading-screen');l.style.opacity='0';l.style.transition='opacity .4s ease';setTimeout(()=>l.style.display='none',400);},1200);
  buildAllPeriods();setCurrentPeriod();renderResumen();
}
function setSyncStatus(ok){document.getElementById('sync-dot').style.background=ok?'#4caf50':'#e50914';document.getElementById('sync-text').textContent=ok?'Sincronizado':'Sin conexi√≥n';}
function showPage(name,el){
  document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));
  document.querySelectorAll('.topbar-nav-item').forEach(n=>n.classList.remove('active'));
  document.getElementById('page-'+name).classList.add('active');el.classList.add('active');
  window.scrollTo({top:0,behavior:'smooth'});
  if(name==='resumen')renderResumen();if(name==='gastos')renderGastos();if(name==='tarjetas')renderTarjetas();
}
function getMonthKey(y,m){return`${y}-${String(m+1).padStart(2,'0')}`;}
function nextMk(mk){const[y,m]=mk.split('-').map(Number);const d=new Date(y,m,1);return getMonthKey(d.getFullYear(),d.getMonth());}
function getCierreDia(tid,mk){const c=cierres.find(c=>c.tarjeta_id===tid&&c.mes_key===mk);return c?c.dia:null;}
function getCierreForFecha(tid,fechaStr){
  const fc=new Date(fechaStr+'T12:00:00');
  for(let i=0;i<24;i++){const d=new Date(fc.getFullYear(),fc.getMonth()+i,1);const mk=getMonthKey(d.getFullYear(),d.getMonth());const dia=getCierreDia(tid,mk);if(!dia)continue;if(new Date(d.getFullYear(),d.getMonth(),dia)>=fc)return mk;}
  return null;
}
function getCuotasPorPeriodo(g){
  const r={};const mk0=getCierreForFecha(g.tarjeta_id,g.fecha);if(!mk0)return r;
  const cm=g.monto/g.cuotas;let mk=mk0;
  for(let i=0;i<g.cuotas;i++){r[mk]=(r[mk]||0)+cm;mk=nextMk(mk);}
  return r;
}
function getPeriodRange(tid,mk){
  const[y,m]=mk.split('-').map(Number);const dA=getCierreDia(tid,mk);if(!dA)return null;
  const d=new Date(y,m-1,1);const mkP=getMonthKey(d.getFullYear(),d.getMonth()-1);const dP=getCierreDia(tid,mkP);if(!dP)return null;
  return{desde:new Date(d.getFullYear(),d.getMonth()-1,dP+1),hasta:new Date(d.getFullYear(),d.getMonth(),dA)};
}
function buildAllPeriods(){const s=new Set();cierres.forEach(c=>s.add(c.mes_key));allPeriods=[...s].sort();}
function setCurrentPeriod(){if(!allPeriods.length)return;const now=new Date();const mkN=getMonthKey(now.getFullYear(),now.getMonth());const idx=allPeriods.indexOf(mkN);currentPeriodIdx=idx>=0?idx:allPeriods.length-1;}
function changePeriod(dir){currentPeriodIdx=Math.max(0,Math.min(allPeriods.length-1,currentPeriodIdx+dir));renderResumen();}
function mkToLabel(mk){const[y,m]=mk.split('-').map(Number);return['Enero','Febrero','Marzo','Abril','Mayo','Junio','Julio','Agosto','Septiembre','Octubre','Noviembre','Diciembre'][m-1]+' '+y;}
function mkToShort(mk){const[y,m]=mk.split('-').map(Number);return['Ene','Feb','Mar','Abr','May','Jun','Jul','Ago','Sep','Oct','Nov','Dic'][m-1]+' '+y;}
function renderResumen(){
  buildAllPeriods();
  const statsRow=document.getElementById('stats-row');const detailsEl=document.getElementById('tarjeta-details');
  if(!tarjetas.length||!allPeriods.length){
    document.getElementById('hero-period-title').textContent='‚Äî';document.getElementById('hero-period-sub').textContent='Configur√° tus tarjetas y fechas de cierre';document.getElementById('period-label').textContent='‚Äî';
    statsRow.innerHTML='';detailsEl.innerHTML='<div class="empty-state"><div class="empty-icon">üìä</div><div class="empty-title">Sin datos a√∫n</div></div>';return;
  }
  if(currentPeriodIdx>=allPeriods.length)currentPeriodIdx=allPeriods.length-1;
  const mk=allPeriods[currentPeriodIdx];const[y,m]=mk.split('-').map(Number);
  const esFuturo=new Date(y,m-1,28)>new Date();
  document.getElementById('hero-period-title').textContent=mkToLabel(mk);
  document.getElementById('hero-period-sub').textContent=esFuturo?'Per√≠odo futuro ‚Äî monto estimado':'Per√≠odo cerrado o en curso';
  document.getElementById('period-label').textContent=mkToShort(mk);
  let totalGeneral=0;const perTarjeta=[];
  tarjetas.forEach(t=>{let total=0;const gEP=[];gastos.forEach(g=>{if(g.tarjeta_id!==t.id)return;const dist=getCuotasPorPeriodo(g);if(dist[mk]){total+=dist[mk];gEP.push({g,monto:dist[mk]});}});totalGeneral+=total;perTarjeta.push({t,total,gEP,range:getPeriodRange(t.id,mk)});});
  let sHTML=`<div class="stat-card highlight"><div class="stat-label">Total del per√≠odo</div><div class="stat-amount ${esFuturo?'red':''}">$${fmt(totalGeneral)}</div><div class="stat-sub">${esFuturo?'üìÖ Estimado':'‚úÖ Facturado'}</div></div>`;
  perTarjeta.forEach(({t,total})=>{const pct=totalGeneral?Math.round(total/totalGeneral*100):0;sHTML+=`<div class="stat-card"><div class="stat-label"><span style="display:inline-block;width:8px;height:8px;border-radius:50%;background:${t.color};margin-right:6px;"></span>${t.banco}</div><div class="stat-amount" style="font-size:26px;">$${fmt(total)}</div><div class="stat-bar"><div class="stat-bar-fill" style="width:${pct}%;background:${t.color};"></div></div><div class="stat-pct">${pct}% del total</div></div>`;});
  statsRow.innerHTML=sHTML;
  let dHTML='';
  perTarjeta.forEach(({t,total,gEP,range})=>{
    if(!gEP.length&&!range)return;
    const desde=range?formatDate(range.desde):'‚Äî';const hasta=range?formatDate(range.hasta):'‚Äî';
    const rows=gEP.map(({g,monto})=>{const cn=Object.keys(getCuotasPorPeriodo(g)).sort().indexOf(mk)+1;const isSingle=g.cuotas===1;return`<tr><td><div style="font-weight:600;">${g.categoria?g.categoria+' ':''}${g.descripcion}</div>${g.nota?`<div style="color:var(--muted);font-size:11px;margin-top:2px;">${g.nota}</div>`:''}</td><td style="color:var(--muted);font-size:12px;">${formatDate(new Date(g.fecha+'T12:00:00'))}</td><td><span class="cuota-tag ${isSingle?'single':''}">${isSingle?'1 PAGO':`${cn}/${g.cuotas}`}</span></td><td style="font-weight:700;text-align:right;">$${fmt(monto)}</td></tr>`;}).join('');
    dHTML+=`<div class="tarjeta-cards-section"><div class="tarjeta-detail"><div class="tarjeta-detail-header"><div class="td-left"><div class="td-stripe" style="background:${t.color};"></div><div><div class="td-bank">${t.banco} <span style="font-weight:400;color:var(--muted);font-size:14px;">‚Äî ${t.nombre}${t.digitos?' ¬∑¬∑¬∑¬∑ '+t.digitos:''}</span></div><div class="td-info">Per√≠odo: ${desde} ‚Üí ${hasta}</div></div></div><div style="text-align:right;"><div class="td-amount" style="color:${esFuturo?'var(--red)':'var(--text)'};">$${fmt(total)}</div><div style="font-size:11px;color:var(--muted);">${esFuturo?'estimado':'facturado'}</div></div></div>${gEP.length?`<table class="data-table"><thead><tr><th>Concepto</th><th>Fecha compra</th><th>Cuotas</th><th style="text-align:right;">Monto</th></tr></thead><tbody>${rows}</tbody><tfoot><tr class="total-row"><td colspan="3">TOTAL TARJETA</td><td style="text-align:right;">$${fmt(total)}</td></tr></tfoot></table>`:'<div style="padding:20px 24px;color:var(--muted);font-size:13px;">Sin gastos en este per√≠odo</div>'}</div></div>`;
  });
  detailsEl.innerHTML=dHTML||'<div class="empty-state"><div class="empty-icon">üéâ</div><div class="empty-title">Sin gastos este per√≠odo</div></div>';
}
function renderGastos(){
  const tbody=document.getElementById('gastos-tbody');const empty=document.getElementById('gastos-empty');const now=new Date();
  let lista=[...gastos];
  if(gastoFilter==='pendientes')lista=lista.filter(g=>{const mks=Object.keys(getCuotasPorPeriodo(g)).sort();if(!mks.length)return true;const[y,m]=mks[mks.length-1].split('-').map(Number);return new Date(y,m-1,28)>=now;});
  else if(gastoFilter==='pasados')lista=lista.filter(g=>{const mks=Object.keys(getCuotasPorPeriodo(g)).sort();if(!mks.length)return false;const[y,m]=mks[mks.length-1].split('-').map(Number);return new Date(y,m-1,28)<now;});
  if(!lista.length){tbody.innerHTML='';empty.style.display='block';return;}
  empty.style.display='none';
  tbody.innerHTML=lista.map(g=>{const t=tarjetas.find(t=>t.id===g.tarjeta_id);return`<tr><td><div style="font-weight:600;">${g.categoria?g.categoria+' ':''}${g.descripcion}</div>${g.nota?`<div style="color:var(--muted);font-size:11px;margin-top:2px;">${g.nota}</div>`:''}</td><td>${t?`<span class="cc-badge" style="background:${t.color}">${t.banco}</span>`:'‚Äî'}</td><td style="color:var(--muted);">${formatDate(new Date(g.fecha+'T12:00:00'))}</td><td style="font-weight:700;">$${fmt(g.monto)}</td><td style="color:var(--muted);">${g.cuotas>1?`${g.cuotas}x $${fmt(g.monto/g.cuotas)}`:'1 pago'}</td><td><button class="btn btn-danger-sm" onclick="deleteGasto('${g.id}')">‚úï</button></td></tr>`;}).join('');
}
function filterGastos(f,el){gastoFilter=f;document.querySelectorAll('.filter-tab').forEach(t=>t.classList.remove('active'));el.classList.add('active');renderGastos();}
function openModalGasto(){
  if(!tarjetas.length){showToast('Primero agreg√° una tarjeta','error');return;}
  document.getElementById('g-tarjeta').innerHTML=tarjetas.map(t=>`<option value="${t.id}">${t.banco} ‚Äì ${t.nombre}</option>`).join('');
  document.getElementById('g-fecha').value=new Date().toISOString().split('T')[0];
  ['g-monto','g-desc','g-nota'].forEach(id=>document.getElementById(id).value='');
  document.getElementById('g-cuotas').value=1;document.getElementById('g-categoria').value='';document.getElementById('cuotas-preview').style.display='none';
  openModal('modal-gasto');
}
function previewCuotas(){
  const cuotas=parseInt(document.getElementById('g-cuotas').value)||1;const monto=parseFloat(document.getElementById('g-monto').value)||0;
  const tid=document.getElementById('g-tarjeta').value;const fecha=document.getElementById('g-fecha').value;
  const prev=document.getElementById('cuotas-preview');
  if(cuotas<=1||!monto||!fecha||!tid){prev.style.display='none';return;}
  const dist=getCuotasPorPeriodo({tarjeta_id:tid,fecha,monto,cuotas});const mks=Object.keys(dist).sort();
  if(!mks.length){prev.style.display='none';return;}
  document.getElementById('cuotas-preview-content').innerHTML=mks.map((mk,i)=>`<div class="cuota-row"><span style="color:var(--muted);">Cuota ${i+1}/${cuotas} ¬∑ ${mkToShort(mk)}</span><span style="font-weight:700;">$${fmt(monto/cuotas)}</span></div>`).join('');
  prev.style.display='block';
}
async function saveGasto(){
  const descripcion=document.getElementById('g-desc').value.trim();const tarjeta_id=document.getElementById('g-tarjeta').value;
  const fecha=document.getElementById('g-fecha').value;const monto=parseFloat(document.getElementById('g-monto').value);
  const cuotas=parseInt(document.getElementById('g-cuotas').value)||1;const categoria=document.getElementById('g-categoria').value;const nota=document.getElementById('g-nota').value.trim();
  if(!descripcion){showToast('Ingres√° una descripci√≥n','error');return;}if(!fecha){showToast('Ingres√° la fecha','error');return;}if(!monto||monto<=0){showToast('Ingres√° un monto v√°lido','error');return;}
  const btn=document.getElementById('btn-save-gasto');btn.disabled=true;btn.innerHTML='<div class="loader"></div> Guardando...';
  const{data,error}=await sb.from('gastos').insert([{descripcion,tarjeta_id,fecha,monto,cuotas,categoria,nota}]).select();
  if(error){showToast('Error al guardar','error');}else{gastos.unshift(data[0]);closeModal('modal-gasto');renderGastos();buildAllPeriods();showToast('Gasto registrado ‚úì');}
  btn.disabled=false;btn.innerHTML='Registrar';
}
async function deleteGasto(id){
  if(!confirm('¬øEliminar este gasto?'))return;
  const{error}=await sb.from('gastos').delete().eq('id',id);
  if(error){showToast('Error','error');return;}
  gastos=gastos.filter(g=>g.id!==id);renderGastos();showToast('Gasto eliminado');
}
function renderTarjetas(){
  const grid=document.getElementById('cards-grid');const empty=document.getElementById('tarjetas-empty');
  if(!tarjetas.length){grid.innerHTML='';empty.style.display='block';return;}empty.style.display='none';
  grid.innerHTML=tarjetas.map(t=>{const count=cierres.filter(c=>c.tarjeta_id===t.id).length;return`<div class="cc-visual" style="background:linear-gradient(135deg,${t.color} 0%,${darken(t.color)} 100%);"><div class="cc-circles"></div><div><div class="cc-bank-name">${t.banco}</div><div class="cc-card-name">${t.nombre}</div></div><div class="cc-chip-icon">üü°</div><div><div class="cc-bottom"><div class="cc-number">${t.digitos?'¬∑¬∑¬∑¬∑ ¬∑¬∑¬∑¬∑ ¬∑¬∑¬∑¬∑ '+t.digitos:'¬∑¬∑¬∑¬∑ ¬∑¬∑¬∑¬∑ ¬∑¬∑¬∑¬∑ ¬∑¬∑¬∑¬∑'}</div><div class="cc-meta">${count} cierre${count!==1?'s':''}<br>configurado${count!==1?'s':''}</div></div><div class="cc-footer-btns" onclick="event.stopPropagation()"><button class="cc-btn" onclick="openCierres('${t.id}')">üìÖ Cierres</button><button class="cc-btn" onclick="editTarjeta('${t.id}')">‚úèÔ∏è Editar</button><button class="cc-btn" onclick="deleteTarjeta('${t.id}')">‚úï</button></div></div></div>`;}).join('');
}
function darken(hex){try{const r=parseInt(hex.slice(1,3),16),g=parseInt(hex.slice(3,5),16),b=parseInt(hex.slice(5,7),16);return`rgb(${Math.max(0,r-40)},${Math.max(0,g-40)},${Math.max(0,b-40)})`;}catch{return hex;}}
function openModalTarjeta(){editingTarjetaId=null;document.getElementById('modal-tarjeta-title').textContent='Nueva Tarjeta';['tc-banco','tc-nombre','tc-digitos'].forEach(id=>document.getElementById(id).value='');selectedColor='#e50914';document.querySelectorAll('.color-dot').forEach(d=>d.classList.toggle('selected',d.dataset.color===selectedColor));openModal('modal-tarjeta');}
function editTarjeta(id){const t=tarjetas.find(t=>t.id===id);if(!t)return;editingTarjetaId=id;document.getElementById('modal-tarjeta-title').textContent='Editar Tarjeta';document.getElementById('tc-banco').value=t.banco;document.getElementById('tc-nombre').value=t.nombre;document.getElementById('tc-digitos').value=t.digitos||'';selectedColor=t.color;document.querySelectorAll('.color-dot').forEach(d=>d.classList.toggle('selected',d.dataset.color===t.color));openModal('modal-tarjeta');}
async function saveTarjeta(){
  const banco=document.getElementById('tc-banco').value.trim();const nombre=document.getElementById('tc-nombre').value.trim();const digitos=document.getElementById('tc-digitos').value.trim();
  if(!banco){showToast('Ingres√° el banco','error');return;}if(!nombre){showToast('Ingres√° el nombre','error');return;}
  const btn=document.getElementById('btn-save-tarjeta');btn.disabled=true;btn.innerHTML='<div class="loader"></div>';
  if(editingTarjetaId){const{error}=await sb.from('tarjetas').update({banco,nombre,digitos,color:selectedColor}).eq('id',editingTarjetaId);if(error){showToast('Error','error');}else{Object.assign(tarjetas.find(t=>t.id===editingTarjetaId),{banco,nombre,digitos,color:selectedColor});closeModal('modal-tarjeta');renderTarjetas();showToast('Tarjeta actualizada ‚úì');}}
  else{const{data,error}=await sb.from('tarjetas').insert([{banco,nombre,digitos,color:selectedColor}]).select();if(error){showToast('Error','error');}else{tarjetas.push(data[0]);closeModal('modal-tarjeta');renderTarjetas();showToast('Tarjeta creada ‚úì');}}
  btn.disabled=false;btn.innerHTML='Guardar';
}
async function deleteTarjeta(id){
  if(!confirm('¬øEliminar esta tarjeta?'))return;
  const{error}=await sb.from('tarjetas').delete().eq('id',id);if(error){showToast('Error','error');return;}
  tarjetas=tarjetas.filter(t=>t.id!==id);cierres=cierres.filter(c=>c.tarjeta_id!==id);gastos=gastos.filter(g=>g.tarjeta_id!==id);
  renderTarjetas();document.getElementById('cierres-panel').classList.remove('open');showToast('Tarjeta eliminada');
}
function selectColor(el){selectedColor=el.dataset.color;document.querySelectorAll('.color-dot').forEach(d=>d.classList.remove('selected'));el.classList.add('selected');}
function openCierres(tid){
  const t=tarjetas.find(t=>t.id===tid);document.getElementById('cierres-panel-title').textContent=`${t.banco} ‚Äî ${t.nombre}`;
  const panel=document.getElementById('cierres-panel');panel.classList.add('open');panel.dataset.tid=tid;renderCierresGrid(tid);panel.scrollIntoView({behavior:'smooth'});
}
function renderCierresGrid(tid){
  const now=new Date();const meses=['Ene','Feb','Mar','Abr','May','Jun','Jul','Ago','Sep','Oct','Nov','Dic'];let html='';
  for(let offset=-3;offset<=9;offset++){const d=new Date(now.getFullYear(),now.getMonth()+offset,1);const mk=getMonthKey(d.getFullYear(),d.getMonth());const cierre=cierres.find(c=>c.tarjeta_id===tid&&c.mes_key===mk);const dia=cierre?cierre.dia:'';html+=`<div class="cierre-month-cell"><div class="cierre-month-label">${meses[d.getMonth()]} ${d.getFullYear()}</div><div class="cierre-day-input"><input type="number" min="1" max="31" placeholder="D√≠a" style="width:72px;padding:8px 10px;font-size:14px;font-weight:700;" value="${dia}" onchange="saveCierre('${tid}','${mk}',this.value,'${cierre?cierre.id:''}')"><span class="cierre-day-val" id="cl-${mk}">${dia?'d√≠a '+dia:'‚Äî'}</span></div></div>`;}
  document.getElementById('cierres-month-grid').innerHTML=html;
}
async function saveCierre(tid,mk,valor,existingId){
  const dia=parseInt(valor);
  if(dia>=1&&dia<=31){
    if(existingId){const{error}=await sb.from('cierres').update({dia}).eq('id',existingId);if(!error){const c=cierres.find(c=>c.id===existingId);if(c)c.dia=dia;const lbl=document.getElementById('cl-'+mk);if(lbl)lbl.textContent='d√≠a '+dia;}}
    else{const{data,error}=await sb.from('cierres').insert([{tarjeta_id:tid,mes_key:mk,dia}]).select();if(!error){cierres.push(data[0]);renderCierresGrid(tid);}}
    buildAllPeriods();showToast('Cierre guardado ‚úì');
  }else if(!valor&&existingId){await sb.from('cierres').delete().eq('id',existingId);cierres=cierres.filter(c=>c.id!==existingId);renderCierresGrid(tid);buildAllPeriods();}
}
function closeCierres(){document.getElementById('cierres-panel').classList.remove('open');}
function openModal(id){document.getElementById(id).classList.add('open');}
function closeModal(id){document.getElementById(id).classList.remove('open');}
function fmt(n){if(!n)return'0';const r=Math.round(n*100)/100;return r%1===0?r.toLocaleString('es-AR'):r.toLocaleString('es-AR',{minimumFractionDigits:2,maximumFractionDigits:2});}
function formatDate(d){if(!d||isNaN(d))return'‚Äî';return`${d.getDate()} ${['Ene','Feb','Mar','Abr','May','Jun','Jul','Ago','Sep','Oct','Nov','Dic'][d.getMonth()]} ${d.getFullYear()}`;}
function showToast(msg,type='success'){const t=document.getElementById('toast');t.textContent=(type==='success'?'‚úì  ':' ‚úï  ')+msg;t.className=`toast show ${type}`;clearTimeout(t._t);t._t=setTimeout(()=>t.className='toast',3000);}
document.querySelectorAll('.modal-overlay').forEach(o=>o.addEventListener('click',e=>{if(e.target===o)o.classList.remove('open');}));
init();
</script>
</body>
</html>
